<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>High5 Gen Book - Thanh to√°n PayPal ph√≠a client</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1000px;
            margin: 0 auto;
            padding: 20px;
            background: #f8f9fa;
        }
        .checkout-container {
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: 30px;
            margin-top: 20px;
        }
        .checkout-form, .order-summary {
            background: white;
            border: 1px solid #ddd;
            border-radius: 8px;
            padding: 30px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        h1 {
            color: #333;
            margin-bottom: 30px;
            font-size: 28px;
        }
        h2 {
            color: #333;
            margin-bottom: 20px;
            font-size: 20px;
            border-bottom: 2px solid #007bff;
            padding-bottom: 10px;
        }
        .form-section {
            margin-bottom: 30px;
        }
        .form-group {
            margin: 15px 0;
        }
        label {
            display: block;
            margin-bottom: 8px;
            font-weight: bold;
            color: #555;
        }
        input[type="text"], input[type="email"], select {
            width: 100%;
            padding: 12px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 16px;
            box-sizing: border-box;
        }
        input:focus, select:focus {
            outline: none;
            border-color: #007bff;
            box-shadow: 0 0 5px rgba(0,123,255,0.3);
        }
        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }
        .paypal-section {
            text-align: center;
            margin: 30px 0;
            padding: 30px;
            border: 2px solid #007bff;
            border-radius: 8px;
            background: #f8f9ff;
        }
        .paypal-section h3 {
            color: #007bff;
            margin-bottom: 20px;
        }
        #payment-buttons-container {
            display: grid;
            gap: 20px;
            margin: 20px 0;
        }

        .payment-button-wrapper {
            background: #f8f9fa;
            border: 2px solid #e9ecef;
            border-radius: 8px;
            padding: 20px;
            text-align: center;
            transition: all 0.3s ease;
        }

        .payment-button-wrapper:hover {
            border-color: #007bff;
            box-shadow: 0 2px 8px rgba(0,123,255,0.1);
        }

        .payment-button-wrapper h4 {
            margin: 0 0 15px 0;
            color: #333;
            font-size: 16px;
        }

        #paypal-button-container,
        #apple-pay-button-container,
        #google-pay-button-container,
        #amazon-pay-button-container {
            min-height: 40px;
        }

        #apple-pay-button {
            background: black;
            color: white;
            border: none;
            border-radius: 4px;
            padding: 12px 24px;
            font-size: 16px;
            cursor: pointer;
            font-family: -apple-system, BlinkMacSystemFont, 'SF Pro Display', sans-serif;
        }

        #apple-pay-button:hover {
            background: #333;
        }
        .order-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px 0;
            border-bottom: 1px solid #eee;
        }
        .order-item:last-child {
            border-bottom: none;
        }
        .item-details h4 {
            margin: 0 0 5px 0;
            color: #333;
        }
        .item-details p {
            margin: 0;
            color: #666;
            font-size: 14px;
        }
        .item-price {
            font-weight: bold;
            color: #333;
        }
        .order-total {
            border-top: 2px solid #333;
            padding-top: 15px;
            margin-top: 15px;
            font-size: 18px;
            font-weight: bold;
            color: #28a745;
        }
        .status {
            padding: 15px;
            margin: 20px 0;
            border-radius: 4px;
            display: none;
        }
        .success { background: #d4edda; color: #155724; }
        .error { background: #f8d7da; color: #721c24; }
        .info { background: #d1ecf1; color: #0c5460; }
        @media (max-width: 768px) {
            .checkout-container {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <h1>üõí Thanh to√°n PayPal ph√≠a client - High5 Gen Book</h1>

    <div class="checkout-container">
        <!-- Checkout Form -->
        <div class="checkout-form">
            <h2>üìã Th√¥ng tin thanh to√°n</h2>

            <form id="checkoutForm">
                <div class="form-section">
                    <h3>üë§ Th√¥ng tin li√™n h·ªá</h3>
                    <div class="form-group">
                        <label for="email">ƒê·ªãa ch·ªâ email:</label>
                        <input type="email" id="email" value="test@example.com" placeholder="your@email.com" required>
                    </div>
                </div>

                <div class="form-section">
                    <h3>üìç ƒê·ªãa ch·ªâ thanh to√°n</h3>
                    <div class="form-group">
                        <label for="fullName">H·ªç v√† t√™n:</label>
                        <input type="text" id="fullName" value="Nguy·ªÖn VƒÉn Test" placeholder="Nguy·ªÖn VƒÉn A" required>
                    </div>
                    <div class="form-group">
                        <label for="address">ƒê·ªãa ch·ªâ:</label>
                        <input type="text" id="address" value="123 ƒê∆∞·ªùng Test" placeholder="123 ƒê∆∞·ªùng ABC" required>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="city">Th√†nh ph·ªë:</label>
                            <input type="text" id="city" value="H√† N·ªôi" placeholder="H√† N·ªôi" required>
                        </div>
                        <div class="form-group">
                            <label for="zipCode">M√£ b∆∞u ƒëi·ªán:</label>
                            <input type="text" id="zipCode" value="100000" placeholder="100000" required>
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="country">Qu·ªëc gia:</label>
                        <select id="country" required>
                            <option value="">Ch·ªçn qu·ªëc gia</option>
                            <option value="VN" selected>Vi·ªát Nam</option>
                            <option value="US">United States</option>
                            <option value="CA">Canada</option>
                            <option value="UK">United Kingdom</option>
                        </select>
                    </div>
                </div>

                <div class="paypal-section">
                    <h3>üí≥ Ch·ªçn ph∆∞∆°ng th·ª©c thanh to√°n</h3>
                    <p>ƒêi·ªÅn ƒë·∫ßy ƒë·ªß th√¥ng tin ·ªü tr√™n, sau ƒë√≥ ch·ªçn ph∆∞∆°ng th·ª©c thanh to√°n</p>

                    <!-- Payment Buttons Container -->
                    <div id="payment-buttons-container">
                        <!-- PayPal Button -->
                        <div class="payment-button-wrapper">
                            <h4>üí∞ PayPal</h4>
                    <div id="paypal-button-container"></div>
                        </div>

                        <!-- Apple Pay Button -->
                        <div class="payment-button-wrapper">
                            <h4>üçé Apple Pay</h4>
                            <div id="apple-pay-button-container">
                                <button id="apple-pay-button" style="display: none;">
                                    Pay with Apple Pay
                                </button>
                            </div>
                        </div>

                        <!-- Google Pay Button -->
                        <div class="payment-button-wrapper">
                            <h4>üéØ Google Pay</h4>
                            <div id="google-pay-button-container"></div>
                        </div>

                        <!-- Amazon Pay Button -->
                        <div class="payment-button-wrapper">
                            <h4>üì¶ Amazon Pay</h4>
                            <div id="amazon-pay-button-container"></div>
                        </div>
                    </div>

                    <p style="margin-top: 20px; font-size: 14px; color: #666;">
                        üîí Th√¥ng tin thanh to√°n ƒë∆∞·ª£c b·∫£o m·∫≠t v√† m√£ h√≥a
                    </p>
                </div>
            </form>
        </div>

        <!-- Order Summary -->
        <div class="order-summary">
            <h2>üì¶ T√≥m t·∫Øt ƒë∆°n h√†ng</h2>

            <div class="order-item">
                <div class="item-details">
                    <h4>AI Generated Children's Book</h4>
                    <p>Khoa h·ªçc vi·ªÖn t∆∞·ªüng - Lino kh√°m ph√° v≈© tr·ª•</p>
                    <p>Character: Lino</p>
                    <p>Format: PDF (8 pages)</p>
                </div>
                <div class="item-price">$9.99</div>
            </div>

            <div class="order-item">
                <div class="item-details">
                    <h4>Processing Fee</h4>
                    <p>AI generation and image creation</p>
                </div>
                <div class="item-price">$2.00</div>
            </div>

            <div class="order-item order-total">
                <strong>Total:</strong>
                <strong>$11.99</strong>
            </div>

            <div style="margin-top: 20px; padding: 15px; background: #f8f9fa; border-radius: 4px;">
                <h4 style="margin: 0 0 10px 0; color: #28a745;">üéÅ B·∫°n s·∫Ω nh·∫≠n ƒë∆∞·ª£c:</h4>
                <ul style="margin: 0; padding-left: 20px; color: #666; font-size: 14px;">
                    <li>C√¢u chuy·ªán c√° nh√¢n h√≥a v·ªõi nh√¢n v·∫≠t c·ªßa b·∫°n</li>
                    <li>8 h√¨nh minh h·ªça ƒë·∫πp</li>
                    <li>File PDF ch·∫•t l∆∞·ª£ng cao</li>
                    <li>Giao h√†ng t·ª©c th√¨</li>
                    <li>Quy·ªÅn s·ª≠ d·ª•ng th∆∞∆°ng m·∫°i</li>
                </ul>
            </div>
        </div>
    </div>

    <div id="status" class="status"></div>

    <!-- PayPal SDK will be loaded dynamically -->
    <script>
        // Function to show status
        function showStatus(message, type = 'info') {
            const statusDiv = document.getElementById('status');
            statusDiv.textContent = message;
            statusDiv.className = `status ${type}`;
            statusDiv.style.display = 'block';

            // Auto hide after 5 seconds for non-error messages
            if (type !== 'error') {
                setTimeout(() => {
                    statusDiv.style.display = 'none';
                }, 5000);
            }
        }



        // Initialize PayPal when SDK is loaded
        function initializePayPal() {
            console.log('Initializing PayPal buttons...');

            // Check if container exists
            const container = document.getElementById('paypal-button-container');
            if (!container) {
                console.error('PayPal button container not found');
                showStatus('‚ùå PayPal container kh√¥ng t√¨m th·∫•y', 'error');
                return;
            }

            console.log('PayPal container found, rendering buttons...');
            paypal.Buttons({
                    // Create Order
                    createOrder: function(data, actions) {
                        // Get form data
            const email = document.getElementById('email').value;
            const fullName = document.getElementById('fullName').value;
            const address = document.getElementById('address').value;
            const city = document.getElementById('city').value;
            const zipCode = document.getElementById('zipCode').value;
            const country = document.getElementById('country').value;

            // Validate required fields
            if (!email.trim() || !fullName.trim() || !address.trim() || !city.trim() || !zipCode.trim() || !country) {
                            throw new Error('Vui l√≤ng ƒëi·ªÅn ƒë·∫ßy ƒë·ªß th√¥ng tin!');
            }

                        showStatus('üîÑ ƒêang chu·∫©n b·ªã thanh to√°n...', 'info');

                // Create order data
                const checkoutData = {
                    email: email.trim(),
                    full_name: fullName.trim(),
                    address: address.trim(),
                    city: city.trim(),
                    zip_code: zipCode.trim(),
                    country: country,
                    payment_method: 'paypal'
                };

                        // First create order in our system
                        return fetch('http://localhost:8000/api/v1/payments/paypal/create-order', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(checkoutData)
                        })
                        .then(response => {
                            if (!response.ok) {
                                return response.json().then(err => {
                                    throw new Error(err.detail || 'Failed to create order');
                });
                }
                            return response.json();
                        })
                        .then(result => {
                // Store order ID for later use
                window.currentOrderId = result.order_id;

                            // Now create PayPal order
                return fetch('http://localhost:8000/api/v1/payments/paypal/create-paypal-order', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                                    order_id: result.order_id
                    })
                            });
                })
                .then(response => response.json())
                .then(orderData => {
                    if (orderData.success) {
                                showStatus('‚úÖ ƒê√£ t·∫°o ƒë∆°n h√†ng PayPal!', 'success');
                        return orderData.paypal_order_id;
                    } else {
                        throw new Error(orderData.message || 'Failed to create PayPal order');
                    }
                })
                .catch(error => {
                    console.error('Create order error:', error);
                            showStatus(`‚ùå L·ªói: ${error.message}`, 'error');
                    throw error;
                });
            },

            // On Approve (Payment successful)
            onApprove: function(data, actions) {
                        showStatus('üîÑ ƒêang x·ª≠ l√Ω thanh to√°n...', 'info');

                return fetch('http://localhost:8000/api/v1/payments/paypal/capture-payment', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        order_id: data.orderID,
                        payer_id: data.payerID
                    })
                })
                .then(response => response.json())
                .then(captureData => {
                    if (captureData.success) {
                                showStatus('‚úÖ Thanh to√°n th√†nh c√¥ng! ƒêang chuy·ªÉn h∆∞·ªõng...', 'success');

                        // Redirect to success page
                        setTimeout(() => {
                            window.location.href = `success.html?order_id=${captureData.order_id}`;
                        }, 2000);
                    } else {
                                showStatus(`‚ùå Thanh to√°n th·∫•t b·∫°i: ${captureData.message}`, 'error');
                    }
                })
                .catch(error => {
                    console.error('Capture error:', error);
                            showStatus(`‚ùå L·ªói x·ª≠ l√Ω thanh to√°n: ${error.message}`, 'error');
                });
            },

            // On Error
            onError: function(err) {
                console.error('PayPal error:', err);
                        showStatus('‚ùå Thanh to√°n PayPal th·∫•t b·∫°i. Vui l√≤ng th·ª≠ l·∫°i.', 'error');
            },

            // On Cancel
            onCancel: function(data) {
                        showStatus('‚ÑπÔ∏è ƒê√£ h·ªßy thanh to√°n.', 'info');
                    }
                }).render('#paypal-button-container')
                .then(() => {
                    console.log('PayPal buttons rendered successfully');
                    showStatus('‚úÖ PayPal buttons ƒë√£ s·∫µn s√†ng', 'success');
                })
                .catch(error => {
                    console.error('Failed to render PayPal buttons:', error);
                    showStatus('‚ùå Kh√¥ng th·ªÉ render PayPal buttons', 'error');
                });
        }

        // Load PayPal SDK dynamically with CLIENT_ID from server
        function loadPayPalSDK() {
            console.log('Loading PayPal client config from server...');

            fetch('http://localhost:8000/api/v1/payments/paypal/client-config')
                .then(response => {
                    if (!response.ok) {
                        throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                    }
                    return response.json();
                })
                .then(config => {
                    console.log('PayPal config received:', config);

                    if (!config.client_id) {
                        throw new Error('Client ID not found in config');
                    }

                    // Load PayPal SDK with client ID from server
                    const script = document.createElement('script');
                    script.src = `https://www.paypal.com/sdk/js?client-id=${config.client_id}&currency=USD&components=buttons`;

                    script.onload = function() {
                        console.log('PayPal SDK loaded successfully from server config');
                        if (typeof paypal !== 'undefined') {
                            console.log('PayPal object available, initializing buttons...');
                            initializePayPal();
                            // Initialize other payment methods after PayPal loads
                            initializeOtherPaymentMethods();
                        } else {
                            console.error('PayPal object not found after SDK load');
                            showStatus('‚ùå PayPal SDK t·∫£i th√†nh c√¥ng nh∆∞ng kh√¥ng t√¨m th·∫•y object paypal', 'error');
                        }
                    };

                    script.onerror = function() {
                        console.error('Failed to load PayPal SDK from server config');
                        showStatus('‚ùå Kh√¥ng th·ªÉ t·∫£i h·ªá th·ªëng thanh to√°n PayPal', 'error');
                    };

                    document.head.appendChild(script);
                })
                .catch(error => {
                    console.error('Failed to load PayPal config:', error);
                    showStatus(`‚ùå Kh√¥ng th·ªÉ t·∫£i c·∫•u h√¨nh PayPal: ${error.message}`, 'error');
                });
        }

        // Initialize other payment methods (Apple Pay, Google Pay, Amazon Pay)
        function initializeOtherPaymentMethods() {
            console.log('Initializing other payment methods...');

            // Apple Pay
            initializeApplePay();

            // Google Pay
            initializeGooglePay();

            // Amazon Pay
            initializeAmazonPay();
        }

        // Initialize Apple Pay
        function initializeApplePay() {
            console.log('Initializing Apple Pay...');

            // Check if Apple Pay is available
            if (window.ApplePaySession && ApplePaySession.canMakePayments()) {
                console.log('Apple Pay is available');

                // Load Apple Pay SDK
                const applePayScript = document.createElement('script');
                applePayScript.src = 'https://applepay.cdn-apple.com/jsapi/v1/apple-pay-sdk.js';
                applePayScript.onload = function() {
                    console.log('Apple Pay SDK loaded');

                    // Create Apple Pay button
                    const applePayButton = document.getElementById('apple-pay-button');
                    applePayButton.style.display = 'inline-block';
                    applePayButton.onclick = function() {
                        handleApplePay();
                    };

                    showStatus('‚úÖ Apple Pay ƒë√£ s·∫µn s√†ng', 'success');
                };
                applePayScript.onerror = function() {
                    console.error('Failed to load Apple Pay SDK');
                };
                document.head.appendChild(applePayScript);
            } else {
                console.log('Apple Pay not available on this device');
                document.getElementById('apple-pay-button-container').innerHTML = '<p style="color: #666;">Kh√¥ng kh·∫£ d·ª•ng tr√™n thi·∫øt b·ªã n√†y</p>';
            }
        }

        // Handle Apple Pay payment
        function handleApplePay() {
            // Get form data
            const email = document.getElementById('email').value;
            const fullName = document.getElementById('fullName').value;
            const address = document.getElementById('address').value;
            const city = document.getElementById('city').value;
            const zipCode = document.getElementById('zipCode').value;
            const country = document.getElementById('country').value;

            // Validate required fields
            if (!email.trim() || !fullName.trim() || !address.trim() || !city.trim() || !zipCode.trim() || !country) {
                showStatus('‚ùå Vui l√≤ng ƒëi·ªÅn ƒë·∫ßy ƒë·ªß th√¥ng tin!', 'error');
                return;
            }

            showStatus('üîÑ ƒêang chu·∫©n b·ªã thanh to√°n Apple Pay...', 'info');

            // Create payment request
            const paymentRequest = {
                countryCode: country,
                currencyCode: 'USD',
                supportedNetworks: ['visa', 'masterCard', 'amex'],
                merchantCapabilities: ['supports3DS'],
                total: {
                    label: 'High5 Gen Book',
                    amount: '11.99'
                }
            };

            const session = new ApplePaySession(1, paymentRequest);

            session.onvalidatemerchant = function(event) {
                // Validate merchant with Apple
                fetch('http://localhost:8000/api/v1/payments/apple-pay/validate-merchant', {
                    method: 'POST'
                })
                .then(response => response.json())
                .then(result => {
                    if (result.success) {
                        session.completeMerchantValidation(result.merchant_session);
                    } else {
                        session.abort();
                        showStatus('‚ùå Apple Pay merchant validation failed', 'error');
                    }
                })
                .catch(error => {
                    console.error('Merchant validation error:', error);
                    session.abort();
                    showStatus('‚ùå L·ªói x√°c th·ª±c merchant Apple Pay', 'error');
                });
            };

            session.onpaymentauthorized = function(event) {
                // Process payment
                const paymentToken = event.payment.token;

                // Simulate payment processing (in real app, send to backend)
                setTimeout(() => {
                    session.completePayment(ApplePaySession.STATUS_SUCCESS);
                    showStatus('‚úÖ Thanh to√°n Apple Pay th√†nh c√¥ng!', 'success');
                    setTimeout(() => {
                        window.location.href = 'success.html?payment=apple_pay';
                    }, 2000);
                }, 1000);
            };

            session.oncancel = function(event) {
                showStatus('‚ÑπÔ∏è ƒê√£ h·ªßy thanh to√°n Apple Pay', 'info');
            };

            session.begin();
        }

        // Initialize Google Pay
        function initializeGooglePay() {
            console.log('Initializing Google Pay...');

            // Load Google Pay SDK
            const googlePayScript = document.createElement('script');
            googlePayScript.src = 'https://pay.google.com/gp/p/js/pay.js';
            googlePayScript.onload = function() {
                console.log('Google Pay SDK loaded');

                fetch('http://localhost:8000/api/v1/payments/google-pay/config')
                    .then(response => response.json())
                    .then(config => {
                        if (config.success) {
                            const paymentsClient = new google.payments.api.PaymentsClient({
                                environment: config.environment
                            });

                            paymentsClient.createButton({
                                onClick: () => handleGooglePay(paymentsClient, config),
                                buttonColor: 'default',
                                buttonType: 'buy',
                                buttonLocale: 'en'
                            }).then(button => {
                                document.getElementById('google-pay-button-container').appendChild(button);
                                console.log('Google Pay button created');
                            }).catch(error => {
                                console.error('Failed to create Google Pay button:', error);
                            });
                        } else {
                            console.error('Failed to get Google Pay config');
                        }
                    })
                    .catch(error => {
                        console.error('Failed to load Google Pay config:', error);
                    });
            };
            googlePayScript.onerror = function() {
                console.error('Failed to load Google Pay SDK');
            };
            document.head.appendChild(googlePayScript);
        }

        // Handle Google Pay payment
        function handleGooglePay(paymentsClient, config) {
            // Get form data
            const email = document.getElementById('email').value;
            const fullName = document.getElementById('fullName').value;
            const address = document.getElementById('address').value;
            const city = document.getElementById('city').value;
            const zipCode = document.getElementById('zipCode').value;
            const country = document.getElementById('country').value;

            // Validate required fields
            if (!email.trim() || !fullName.trim() || !address.trim() || !city.trim() || !zipCode.trim() || !country) {
                showStatus('‚ùå Vui l√≤ng ƒëi·ªÅn ƒë·∫ßy ƒë·ªß th√¥ng tin!', 'error');
                return;
            }

            showStatus('üîÑ ƒêang chu·∫©n b·ªã thanh to√°n Google Pay...', 'info');

            const paymentDataRequest = {
                apiVersion: config.apiVersion,
                apiVersionMinor: config.apiVersionMinor,
                allowedPaymentMethods: config.allowedPaymentMethods,
                transactionInfo: {
                    totalPriceStatus: 'FINAL',
                    totalPrice: '11.99',
                    currencyCode: 'USD',
                    countryCode: country
                },
                merchantInfo: config.merchantInfo
            };

            paymentsClient.loadPaymentData(paymentDataRequest)
                .then(paymentData => {
                    // Process payment data
                    console.log('Google Pay payment data:', paymentData);

                    // Send to backend for processing
                    fetch('http://localhost:8000/api/v1/payments/google-pay/process-payment', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify({
                            payment_data: paymentData
                        })
                    })
                    .then(response => response.json())
                    .then(result => {
                        if (result.success) {
                            showStatus('‚úÖ Thanh to√°n Google Pay th√†nh c√¥ng!', 'success');
                            setTimeout(() => {
                                window.location.href = `success.html?order_id=${result.transaction_id}&payment=google_pay`;
                            }, 2000);
                        } else {
                            showStatus(`‚ùå Thanh to√°n Google Pay th·∫•t b·∫°i: ${result.message}`, 'error');
                        }
                    })
                    .catch(error => {
                        console.error('Google Pay processing error:', error);
                        showStatus('‚ùå L·ªói x·ª≠ l√Ω thanh to√°n Google Pay', 'error');
                    });
                })
                .catch(error => {
                    console.error('Google Pay payment cancelled or failed:', error);
                    showStatus('‚ÑπÔ∏è ƒê√£ h·ªßy thanh to√°n Google Pay', 'info');
                });
        }

        // Initialize Amazon Pay
        function initializeAmazonPay() {
            console.log('Initializing Amazon Pay...');

            fetch('http://localhost:8000/api/v1/payments/amazon-pay/config')
                .then(response => response.json())
                .then(config => {
                    if (config.success) {
                        console.log('Amazon Pay config received:', config);

                        // Load Amazon Pay SDK
                        const amazonPayScript = document.createElement('script');
                        amazonPayScript.src = 'https://static-na.payments-amazon.com/checkout.js';
                        amazonPayScript.onload = function() {
                            console.log('Amazon Pay SDK loaded');

                            // Initialize Amazon Pay
                            amazon.Pay.renderButton('#amazon-pay-button-container', {
                                createCheckoutSession: {
                                    url: 'http://localhost:8000/api/v1/payments/amazon-pay/create-checkout-session'
                                },
                                sandbox: config.sandbox,
                                merchantId: config.merchantId,
                                ledgerCurrency: config.ledgerCurrency,
                                checkoutLanguage: config.checkoutLanguage,
                                productType: config.productType,
                                placement: 'Cart',
                                buttonColor: 'Gold'
                            });

                            console.log('Amazon Pay button rendered');
                        };
                        amazonPayScript.onerror = function() {
                            console.error('Failed to load Amazon Pay SDK');
                        };
                        document.head.appendChild(amazonPayScript);
                    } else {
                        console.error('Failed to get Amazon Pay config');
                        document.getElementById('amazon-pay-button-container').innerHTML = '<p style="color: #666;">C·∫•u h√¨nh kh√¥ng kh·∫£ d·ª•ng</p>';
                    }
                })
                .catch(error => {
                    console.error('Failed to load Amazon Pay config:', error);
                    document.getElementById('amazon-pay-button-container').innerHTML = '<p style="color: #666;">Kh√¥ng th·ªÉ t·∫£i c·∫•u h√¨nh</p>';
                });
        }

        // Initialize when page loads
        document.addEventListener('DOMContentLoaded', function() {
            document.getElementById('email').focus();
            loadPayPalSDK();
        });
    </script>
</body>
</html>
